version: 1.0.{build}-{branch}

image:
  - Visual Studio 2015
  - Visual Studio 2017

environment:
  github_release_token:
    secure: PbRZg8hVpAS5WWNZYY461xJOOgZLaDIR8QGM5fX+o11JCLoR+ccdwkbBHldTBcBx
  matrix:
    - nodejs_version: "8"
    - nodejs_version: "7"
    - nodejs_version: "6"

matrix:
  fast_finish: true

platform:
  - x64

init:
  - ps: iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-rdp.ps1'))
install:
  - ps: Install-Product node $env:nodejs_version $env:platform
  - git submodule update --init --recursive
  - npm config set spin false
  - npm i -g npm node-pre-gyp --production
  - npm install

build:
  parallel: true
  verbosity: minimal

test_script:
  - npm test

after_test:
  - node-pre-gyp package 2>&1

deploy:
  - provider: GitHub
    release: camaro-v$(appveyor_build_version)
    artifact: camaro
    auth_token: $(github_release_token)
    draft: false
    prerelease: false
    on:
      appveyor_repo_tag: true